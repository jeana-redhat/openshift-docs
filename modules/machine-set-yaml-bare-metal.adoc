// Module included in the following assemblies:
//
// * machine_management/creating_machinesets/creating-infrastructure-machinesets.adoc
// * machine_management/creating_machinesets/creating-machineset-bare-metal.adoc

ifeval::["{context}" == "creating-infrastructure-machinesets"]
:infra:
endif::[]

:_mod-docs-content-type: REFERENCE
[id="machine-set-yaml-bare-metal_{context}"]
= Sample base YAML for a compute machine set custom resource on bare metal

This sample YAML file defines custom resource (CR) for a compute machine set that creates nodes on bare metal with a basic configuration.

[discrete]
[id="machine-set-yaml-bare-metal-cli-values_{context}"]
== Values obtained by using the OpenShift CLI

If you have installed the {oc-first}, you can use `oc` commands to obtain some of the values for your cluster in the sample.

Cluster name:: The `<cluster_name>` string represents the name of the cluster, which is stored in the infrastructure resource for the cluster. 
You can obtain the cluster name by running the following command:
+
[source,terminal]
----
$ oc get -o jsonpath='{.status.infrastructureName}{"\n"}' infrastructure cluster
----

.Sample bare metal `MachineSet` custom resource
[source,yaml]
----
apiVersion: machine.openshift.io/v1beta1
kind: MachineSet
metadata:
  creationTimestamp: null
  labels:
    machine.openshift.io/cluster-api-cluster: <infrastructure_id> <1>
ifndef::infra[]
  name: <infrastructure_id>-<role> <2>
endif::infra[]
ifdef::infra[]
  name: <infrastructure_id>-infra <2>
endif::infra[]
  namespace: openshift-machine-api
spec:
  replicas: 1
  selector:
    matchLabels:
      machine.openshift.io/cluster-api-cluster: <infrastructure_id> 
ifndef::infra[]
      machine.openshift.io/cluster-api-machineset: <infrastructure_id>-<role> 
endif::infra[]
ifdef::infra[]
      machine.openshift.io/cluster-api-machineset: <infrastructure_id>-infra 
endif::infra[]
  template:
    metadata:
      creationTimestamp: null
      labels:
        machine.openshift.io/cluster-api-cluster: <infrastructure_id> 
ifndef::infra[]
        machine.openshift.io/cluster-api-machine-role: <role> <3>
        machine.openshift.io/cluster-api-machine-type: <role> 
        machine.openshift.io/cluster-api-machineset: <infrastructure_id>-<role> 
endif::infra[]
ifdef::infra[]
        machine.openshift.io/cluster-api-machine-role: infra <3>
        machine.openshift.io/cluster-api-machine-type: infra 
        machine.openshift.io/cluster-api-machineset: <infrastructure_id>-infra 
endif::infra[]
    spec:
      metadata:
        creationTimestamp: null
        labels:
ifndef::infra[]
          node-role.kubernetes.io/<role>: "" 
endif::infra[]
ifdef::infra[]
          node-role.kubernetes.io/infra: "" 
endif::infra[]
      providerSpec:
        value:
          apiVersion: baremetal.cluster.k8s.io/v1alpha1
          hostSelector: {}
          image: <4>
            checksum: http:/192.0.2.0:6181/images/rhcos-<version>.<architecture>.qcow2.<md5sum>
            url: http://192.0.2.0:6181/images/rhcos-<version>.<architecture>.qcow2
          kind: BareMetalMachineProviderSpec
          metadata:
            creationTimestamp: null
          userData:
            name: worker-user-data-managed
ifdef::infra[]
      taints: <5>
      - key: node-role.kubernetes.io/infra
        effect: NoSchedule
endif::infra[]
----
<1> Specify the infrastructure ID that is based on the cluster ID that you set when you provisioned the cluster.
ifndef::infra[]
<2> Specify the infrastructure ID and node role label.
<3> Specify the node role label to add.
endif::infra[]
ifdef::infra[]
<2> Specify the infrastructure ID and `infra` role label.
<3> Specify the `infra` role label to add.
endif::infra[]
<4> In the `checksum` and `url` fields of the `image` stanza, specify the API virtual IP (VIP) address URL. 
Use the values for your IP address and your {op-system} version and architecture.
ifdef::infra[]
<5> Specify a taint to prevent user workloads from being scheduled on infra nodes.
+
[NOTE]
====
After adding the `NoSchedule` taint on the infrastructure node, existing DNS pods running on that node are marked as `misscheduled`. You must either delete or link:https://access.redhat.com/solutions/6592171[add toleration on `misscheduled` DNS pods].
====
endif::infra[]

ifeval::["{context}" == "creating-infrastructure-machinesets"]
:!infra:
endif::[]
ifeval::["{context}" == "cluster-tasks"]
:!infra:
endif::[]
